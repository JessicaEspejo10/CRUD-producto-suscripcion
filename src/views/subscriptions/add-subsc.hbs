<div class="container p-4">
    <div class="row">
        <div class="col-md-5 mx-auto">
            <div class="card text-center">
                <div class="card-header">
                    <h3 class="text-uppercase"> Registrar suscripción </h3>
                </div>
                <div class="card-body">
                    <form id="register">
                        <div class="input-group mt-2">
                            <label for="subscname" class="input-group-text"> Nombre Persona </label>
                            <input class="form-control" type="text" name="subscname" id="subscname"
                                placeholder="Ejm: Jessica" required>
                        </div>

                        <div class="input-group mt-2">
                            <label for="lastname" class="input-group-text"> Apellido Persona </label>
                            <input class="form-control" type="text" name="lastname" id="lastname"
                                placeholder="Ejm: Espejo" required>
                        </div>
                        <div class="input-group mt-2">
                            <label for="email" class="input-group-text"> Correo electrónico </label>
                            <input class="form-control" type="email" name="email" id="email"
                                placeholder="Ejm: usuario@gmail.com" required>
                        </div>
                        <div class="input-group mt-2">
                            <label for="suscription_type" class="input-group-text"> Suscripción </label>
                            <input class="form-control" type="text" name="suscription_type" id="suscription_type"
                                value="{{suscription_type}}" readonly>
                        </div>
                        <div class="input-group mt-2">
                            <label for="value" class="input-group-text"> Precio </label>
                            <input class="form-control" type="text" name="value" id="value" value="{{value}}" readonly>
                        </div>
                        <div class="input-group mt-2">
                            <label for="billing_date" class="input-group-text"> Fecha de inicio </label>
                            <input class="form-control" type="date" name="billing_date" id="billing_date" readonly>
                            <script>

                                function getCurrentDate() {
                                    const today = new Date();
                                    const year = today.getFullYear();
                                    const month = String(today.getMonth() + 1).padStart(2, '0'); // Los meses son de 0 a 11
                                    const day = String(today.getDate()).padStart(2, '0');
                                    return `${year}-${month}-${day}`;
                                }
                                const inputDate = document.getElementById("billing_date");
                                const currentDate = getCurrentDate();
                                inputDate.value = currentDate;
                            </script>
                        </div>

                        <div class="form-group mt-4 d-grid gap-2">
                            <button class="btn btn-success" type="submit"> Registrarme</button>
                        </div>

                    </form>
                    <script>
                        document.getElementById('register').addEventListener('submit', function (event) {
                            event.preventDefault(); // Evitar que el formulario se envíe automáticamente

                            // Recoger los datos del formulario
                            const formData = new FormData(event.target);

                            // Enviar la solicitud POST con fetch
                            fetch('http://localhost:3000/add-subsc', {
                                method: 'POST',
                                body: new URLSearchParams(formData) // Convertir FormData a URLSearchParams para enviar como application/x-www-form-urlencoded
                            })
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('Hubo un problema al enviar el formulario.');
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    console.log('Respuesta del servidor:', data);
                                    // Manejar la respuesta del servidor si es necesario
                                    window.location.href = data.redirectUrl;
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>